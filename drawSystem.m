clear, clc

p = 40*[0 1 0 0;0 0 1 0;0 0 0 1];

figure, hold on, axis equal, xlabel('x'), ylabel('y'), zlabel('z'), grid on

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Cam1
R = eye(3);
t = zeros(3,1);

ax = R*p+t;
plot3([ax(1,1) ax(1,2)],[ax(2,1) ax(2,2)],[ax(3,1) ax(3,2)],'r','linewidth',2)
plot3([ax(1,1) ax(1,3)],[ax(2,1) ax(2,3)],[ax(3,1) ax(3,3)],'g','linewidth',2)
plot3([ax(1,1) ax(1,4)],[ax(2,1) ax(2,4)],[ax(3,1) ax(3,4)],'b','linewidth',2)
text(ax(1,1)+5, ax(2,1)+5, ax(3,1), '\{W/Cam1\}', 'FontSize',10)




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Cam 2
% T = np.linalg.inv(np.r_[np.c_[R, t], [[0,0,0,1]]])
% R = T[:3,:3]; t = T[:3,-1]
R = [0.92594215, -0.00294163, -0.37765392;
    -0.00360253,  0.99985537, -0.01662088;
    0.3776482 ,  0.01675049,  0.92579764];
t = [378.70799884,   1.63202964,  65.34909912]';

ax = R*p+t;
plot3([ax(1,1) ax(1,2)],[ax(2,1) ax(2,2)],[ax(3,1) ax(3,2)],'r','linewidth',2)
plot3([ax(1,1) ax(1,3)],[ax(2,1) ax(2,3)],[ax(3,1) ax(3,3)],'g','linewidth',2)
plot3([ax(1,1) ax(1,4)],[ax(2,1) ax(2,4)],[ax(3,1) ax(3,4)],'b','linewidth',2)
text(ax(1,1)+5, ax(2,1)+5, ax(3,1), '\{Cam2\}', 'FontSize',10)




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% T_P_W[0] <---> US Probe system
% R = [-0.80687897, -0.53017134,  0.25694151;
%     -0.50061925,  0.38591858, -0.77541865;
%     0.31357087, -0.75497364, -0.57680356];
% t = [-28.80340305,  39.21513964, 770.7178416]';

R = [0.89517998,  0.16888922, -0.41151722;
    0.2513837 , -0.95699133,  0.1490046;
    -0.36804759, -0.23588985, -0.89913548];
t = [14.69697595, -74.92418625, 821.15189453]';

ax = R*p+t;
plot3([ax(1,1) ax(1,2)],[ax(2,1) ax(2,2)],[ax(3,1) ax(3,2)],'r','linewidth',2)
plot3([ax(1,1) ax(1,3)],[ax(2,1) ax(2,3)],[ax(3,1) ax(3,3)],'g','linewidth',2)
plot3([ax(1,1) ax(1,4)],[ax(2,1) ax(2,4)],[ax(3,1) ax(3,4)],'b','linewidth',2)
text(ax(1,1)+5, ax(2,1), ax(3,1), '\{T\}', 'FontSize',12)




%%%%%%%%%%%%%%%%%%%%%%%%%%%% T_I_W = T_P_W[0] @ T_I_P <---> US image system
% R = [0.81113659,  0.53998875,  0.22050817;
%     0.48344509, -0.40995765, -0.77397831;
%     -0.3291667 ,  0.73507668, -0.59357038];
% t = [-20.69787466,   9.04122967, 857.45349076]';

R = [-0.90407527, -0.18413288, -0.38465593;
    -0.25059168,  0.96080854,  0.1236095;
    0.34621748,  0.20719828, -0.9147404];
t = [42.91844597,   8.21396091, 849.31635951]';

p2 = 20*[0 1 0 0;0 0 1 0;0 0 0 1];
ax = R*p2+t;
plot3([ax(1,1) ax(1,2)],[ax(2,1) ax(2,2)],[ax(3,1) ax(3,2)],'r','linewidth',2)
plot3([ax(1,1) ax(1,3)],[ax(2,1) ax(2,3)],[ax(3,1) ax(3,3)],'g','linewidth',2)
plot3([ax(1,1) ax(1,4)],[ax(2,1) ax(2,4)],[ax(3,1) ax(3,4)],'b','linewidth',2)
text(ax(1,1)-10, ax(2,1), ax(3,1), '\{I\}', 'FontSize',14)
%%%%%%%%%%%%%%%%%%%%%%%%%%% Plot image plane
w = 40;
h = 80;
pln = [0 w w 0;0 0 h h;0 0 0 0];
ptc = R*pln+t;

patch('Vertices', ptc','Faces',[1 2 3 4],'FaceColor','y','FaceAlpha',.5)





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% np.linalg.inv(T_W_C) <---> Cross-wire system
R = eye(3);
t = [14.59518884,  14.95449966, 862.13307079]';

ax = R*p+t;
plot3([ax(1,1) ax(1,2)],[ax(2,1) ax(2,2)],[ax(3,1) ax(3,2)],'r','linewidth',2)
plot3([ax(1,1) ax(1,3)],[ax(2,1) ax(2,3)],[ax(3,1) ax(3,3)],'g','linewidth',2)
plot3([ax(1,1) ax(1,4)],[ax(2,1) ax(2,4)],[ax(3,1) ax(3,4)],'b','linewidth',2)
text(ax(1,1)+7, ax(2,1)+7, ax(3,1), '\{F\}', 'FontSize', 12)
pcshow(ax(:,1)', 'VerticalAxis', 'y', 'VerticalAxisDir', 'down')




hold off
% xlim([-300, 400]);
% ylim([-80, 10]);
% zlim([0, 1360]);
camorbit(0, -30);